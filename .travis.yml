language: node_js
sudo: false
filter_secrets: false

env:
  global:
    EDM_VER: "1.10.0"
    EDM_MAJOR_MINOR: "1.10"

matrix:
  include:
      - env: RUNTIME=2.7 TOOLKIT=pyqt
      - env: RUNTIME=2.7 TOOLKIT=pyside
      - env: RUNTIME=3.5 TOOLKIT=pyqt
      - env: RUNTIME=3.6 TOOLKIT=pyqt
      - os: osx
        env: RUNTIME=2.7 TOOLKIT=pyqt
      - os: osx
        env: RUNTIME=2.7 TOOLKIT=pyside
      - os: osx
        env: RUNTIME=3.5 TOOLKIT=pyqt
      - os: osx
        env: RUNTIME=3.6 TOOLKIT=pyqt
      - os: windows
        env: RUNTIME=3.6 TOOLKIT=pyqt

cache:
  pip: true
  directories:
    - $HOME/.ccache

before_install:
  # update tools
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi

  # setup graphics
  - export DISPLAY=:99.0
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sh -e /etc/init.d/xvfb start; fi

  # install EDM
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]] || [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./travis_ci_bootstrap_edm.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then ./install-edm-windows.cmd; fi
  # create EDM environment
  - edm environments create python${RUNTIME} --version ${RUNTIME}
install:
  - edm install -e python${RUNTIME} -y future networkx traits traitsui enable numpy pillow mock haas coverage ${TOOLKIT}
  # FIXME: pygraphviz should be installed for complete testing
  - edm run -e python${RUNTIME} -- pip install git+http://github.com/nucleic/kiwi.git#egg=kiwisolver
  - edm run -e python${RUNTIME} -- python setup.py develop
script:
  - edm run -e python${RUNTIME} -- coverage run -m haas -v
after_success:
  - edm run -e python${RUNTIME} -- coverage report
