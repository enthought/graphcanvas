language: generic
sudo: false
matrix:
  include:
      - env: RUNTIME=2.7 ETS_TOOLKIT=qt4 QT_API=pyqt
      - env: RUNTIME=2.7 ETS_TOOLKIT=qt4 QT_API=pyside
      - env: RUNTIME=3.5 ETS_TOOLKIT=qt4 QT_API=pyqt
      - env: RUNTIME=3.6 ETS_TOOLKIT=qt4 QT_API=pyqt
      - os: osx
        env: RUNTIME=2.7 ETS_TOOLKIT=qt4 QT_API=pyqt
      - os: osx
        env: RUNTIME=2.7 ETS_TOOLKIT=qt4 QT_API=pyside
      - os: osx
        env: RUNTIME=3.5 ETS_TOOLKIT=qt4 QT_API=pyqt
      - os: osx
        env: RUNTIME=3.6 ETS_TOOLKIT=qt4 QT_API=pyqt

cache:
  pip: true
  directories:
    - $HOME/.ccache

notifications:
  email:
    on_success: change
    on_failure: always

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - export DISPLAY=:99.0
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sh -e /etc/init.d/xvfb start; fi
  - ./travis_ci_bootstrap_edm.sh
  - edm environments create python${RUNTIME} --version ${RUNTIME}
install:
  - edm install -e python${RUNTIME} -y cython networkx pillow swig mock haas coverage ${QT_API}
  # FIXME: pygraphviz should be installed for complete testing
  - edm run -e python${RUNTIME} -- pip install git+https://github.com/nucleic/kiwi.git#egg=kiwisolver
  # Install ETS packages' master branches from source
  - edm run -e python${RUNTIME} -- pip install --no-deps git+https://github.com/enthought/traits.git
  - edm run -e python${RUNTIME} -- pip install --no-deps git+https://github.com/enthought/traitsui.git
  - edm run -e python${RUNTIME} -- pip install --no-deps git+https://github.com/enthought/pyface.git
  - edm run -e python${RUNTIME} -- pip install --no-deps git+https://github.com/enthought/enable.git
  - edm run -e python${RUNTIME} -- python setup.py develop
script:
  - edm run -e python${RUNTIME} -- coverage run -m haas -v
after_success:
  - edm run -e python${RUNTIME} -- coverage report
